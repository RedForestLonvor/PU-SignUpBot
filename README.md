# PU-SignUpBot
自动报名pu口袋校园的python脚本

## 注意

**名字叫做'_RedForest'的开发者已经毕业了，这个项目已经进入用爱发电模式，欢迎任何形式，任何内容的社区贡献**

这个脚本基于pu的网页端构建，确保你可以通过网页登陆和报名  
建议把这个程序用tmux一类的东西挂在一个服务器的后台  
并且如果在你启动这个程序以后，主办方不讲武德修改了报名时间那么暂时是没有办法的

## 重构优化版本特性

本版本基于原项目进行了全面的重构和优化，主要改进包括：

### 🚀 核心功能增强
- **智能时间同步**: 自动同步服务器时间，确保报名时机精准
- **邮件通知系统**: 报名成功/失败自动发送邮件通知
- **活动智能筛选**: 支持按类型、年级、院系等条件筛选活动，不再需要手动获取活动id
- **自动活动发现**: 自动获取符合条件的可报名活动

### 🛡️ 异常处理升级
- **全面的错误处理**: 增加了网络异常、登录异常、报名异常的处理
- **智能重试机制**: 指数退避重试策略，应对各种失败情况
- **Token自动刷新**: Token失效时自动重新获取
- **时间监控机制**: 实时更新时间变化，适应报名时间的修改

### 📧 邮件系统
- **成功通知**: 报名成功后发送详细的活动信息邮件
- **失败通知**: 报名失败后发送失败原因和下次建议
- **配置灵活**: 支持开启/关闭邮件通知功能

### 🎯 报名逻辑优化
- **精确等待**: 毫秒级精度的报名时间等待
- **多阶段报名**: 分阶段的多线程报名策略
- **智能停止**: 报名成功后立即停止所有相关线程

## 使用方法

### 1. 环境准备
确保Python版本 >= 3.13，安装依赖：
```bash
pip install loguru python-dotenv requests
```

### 2. 配置邮件（可选）
创建 `.env` 文件并配置邮件信息：
```
EMAIL_SERVER= # 邮箱服务器，如qq邮箱：smtp.qq.com
EMAIL_PORT= # 邮箱端口，如qq邮箱：465、587
EMAIL_HOST=your_email@domain.com
EMAIL_SMTP_PASS=your_smtp_password
```

### 3. 运行程序
```bash
python main.py
```

### 4. 按提示操作
- 添加用户信息（用户名、密码、学校、院系、邮箱）
- 选择活动筛选方式
- 选择要报名的活动
- 程序会自动监控并开始报名

## 代码情况

会多线程的发请求，报名成功会停止

如果一直没有报名成功，会持续报名60s防止服务器原因导致的报名失败

## 新增功能详解

### 活动筛选系统
- 支持按活动分类筛选
- 支持按参与年级筛选  
- 支持按举办组织筛选
- 支持按院系限制筛选
- 自动排除已结束和需要审核的活动

### 时间同步与监控
- 自动同步服务器时间，消除本地时间误差
- 实时监控活动开始时间变化
- 智能调整等待策略，适应时间修改
- 毫秒级精度的报名时间控制

### 邮件通知内容
**成功邮件包含**：
- 活动名称、分类、组织
- 活动时间、地点、分数
- 温馨提示和注意事项


## TODO

+ 1. 处理一下因为服务器原因导致登陆被挤掉的情况 （已优化重试机制）
+ 2. 处理更多异常情况和返回值 （已全面升级异常处理）
+ 3. 处理一下活动报名时间修改导致的问题 （已添加时间监控机制）
